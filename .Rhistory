# other input
stepDuration = 0.5
nMS = 10
traceDecay = 0.985
sigma = 0.2
# genrate
otherPara = getOtherPara(cond, stepDuration)
MSPara = getMSPara(cond, stepDuration, nMS, traceDecay, sigma)
############# simulate for the distribution of toalEarnings ##########
nPara = 5
paraNames = c('phi', 'tau', 'gamma', 'lambda', 'wIni')
nValue = 3
nComb = nValue ^ nPara
initialSpace = matrix(NA, nValue^nPara, nPara)
initialSpace[,1] = rep(c(0.01, 0.05, 0.2), each = nValue^(nPara - 1)) # phi
initialSpace[,2] = rep(rep(seq(8, 24, 8), each = nValue), nValue^(nPara - 2)) # tau
initialSpace[,3] = rep(rep(seq(0.90, 0.98, 0.04), each = nValue^2), nValue^(nPara - 3))
initialSpace[,4] = rep(rep(seq(0.90, 0.98, 0.04), each = nValue^3), nValue^(nPara - 4))
initialSpace[,5] = rep(rep(seq(2, 8, 3), each = nValue^4), nValue^(nPara - 5))
outFile = 'QStarData'
save('initialSpace', 'nValue', 'nPara', 'paraNames', 'nComb',
file = sprintf('%s/initialSpace.RData', outFile))
# set seed
set.seed(123)
# simualte
nRep = 5
tMax = otherPara[['tMax']]
TrialEarnings = array(dim = c(nValue^nPara, nRep, blockSecs / iti + 1))
RewardDelays = array(dim = c(nValue^nPara, nRep, blockSecs / iti + 1))
Ws = array(dim = c(nValue^nPara, nRep, tMax / stepDuration)) # diifferent from master
TimeWaited = array(dim = c(nValue^nPara, nRep, blockSecs / iti + 1))
vaQuits = array(dim = c(nValue^nPara, nRep, tMax / stepDuration, blockSecs / iti + 1))
vaWaits = array(dim = c(nValue^nPara, nRep, tMax / stepDuration, blockSecs / iti + 1))
for(i in 1 : 1:nrow(initialSpace)){
para = initialSpace[i,]
for(j in 1 : nRep ){
tempt=  QStarModel(para,MSPara, otherPara, cond)
TrialEarnings[i, j,] = tempt[['trialEarnings']]
Ws[i, j,] = tempt[['ws']]
RewardDelays[i, j,] = tempt[['rewardDelays']]
TimeWaited[i, j, ] = tempt[['timeWaited']]
vaQuits[i, j,  , ] = tempt[['vaQuits']]
vaWaits[i, j, ,  ] = tempt[['vaWaits']]
}
}
# organize and save outputs
outputData = list("ws" = Ws, "timeWaited" = TimeWaited,
"rewardDelays" = RewardDelays, "trialEarnings" = TrialEarnings,
"vaWaits" = vaWaits, "vaQuits" = vaQuits
)
### output file ####
outFile = 'outputs/QStarData'
################## read data #################
# library
library('ggplot2')
library('dplyr')
library('tidyr')
source('model.R') # QStar model
source('subFxs/wtwSettings.R') # wtw settings for both HP and LP
# can't change
source('subFxs/paraFxs.R') # functions to get MSPara and otherPara from inputs and wtwSettings
# can change for different MS model, and
################ input ################
# cond input
condIdx = 2
cond = conditions[condIdx];
condName = conditionNames[condIdx]
condColor = conditionColors[condIdx]
sprintf('Condition : %s %s', cond, condName)
# other input
stepDuration = 0.5
nMS = 10
traceDecay = 0.985
sigma = 0.2
# genrate
otherPara = getOtherPara(cond, stepDuration)
MSPara = getMSPara(cond, stepDuration, nMS, traceDecay, sigma)
############# simulate for the distribution of toalEarnings ##########
nPara = 5
paraNames = c('phi', 'tau', 'gamma', 'lambda', 'wIni')
nValue = 3
nComb = nValue ^ nPara
initialSpace = matrix(NA, nValue^nPara, nPara)
initialSpace[,1] = rep(c(0.01, 0.05, 0.2), each = nValue^(nPara - 1)) # phi
initialSpace[,2] = rep(rep(seq(8, 24, 8), each = nValue), nValue^(nPara - 2)) # tau
initialSpace[,3] = rep(rep(seq(0.90, 0.98, 0.04), each = nValue^2), nValue^(nPara - 3))
initialSpace[,4] = rep(rep(seq(0.90, 0.98, 0.04), each = nValue^3), nValue^(nPara - 4))
initialSpace[,5] = rep(rep(seq(2, 8, 3), each = nValue^4), nValue^(nPara - 5))
outFile = 'QStarData'
save('initialSpace', 'nValue', 'nPara', 'paraNames', 'nComb',
file = sprintf('%s/initialSpace.RData', outFile))
# set seed
set.seed(123)
# simualte
nRep = 5
tMax = otherPara[['tMax']]
TrialEarnings = array(dim = c(nValue^nPara, nRep, blockSecs / iti + 1))
RewardDelays = array(dim = c(nValue^nPara, nRep, blockSecs / iti + 1))
Ws = array(dim = c(nValue^nPara, nRep, tMax / stepDuration)) # diifferent from master
TimeWaited = array(dim = c(nValue^nPara, nRep, blockSecs / iti + 1))
vaQuits = array(dim = c(nValue^nPara, nRep, tMax / stepDuration, blockSecs / iti + 1))
vaWaits = array(dim = c(nValue^nPara, nRep, tMax / stepDuration, blockSecs / iti + 1))
for(i in 1 : 1:nrow(initialSpace)){
para = initialSpace[i,]
for(j in 1 : nRep ){
tempt=  QStarModel(para,MSPara, otherPara, cond)
TrialEarnings[i, j,] = tempt[['trialEarnings']]
Ws[i, j,] = tempt[['ws']]
RewardDelays[i, j,] = tempt[['rewardDelays']]
TimeWaited[i, j, ] = tempt[['timeWaited']]
vaQuits[i, j,  , ] = tempt[['vaQuits']]
vaWaits[i, j, ,  ] = tempt[['vaWaits']]
}
}
### output file ####
outFile = 'outputs/QStarData'
################## read data #################
# library
library('ggplot2')
library('dplyr')
library('tidyr')
source('model.R') # QStar model
source('subFxs/wtwSettings.R') # wtw settings for both HP and LP
# can't change
source('subFxs/paraFxs.R') # functions to get MSPara and otherPara from inputs and wtwSettings
# can change for different MS model, and
################ input ################
# cond input
condIdx = 2
cond = conditions[condIdx];
condName = conditionNames[condIdx]
condColor = conditionColors[condIdx]
sprintf('Condition : %s %s', cond, condName)
# other input
stepDuration = 0.5
nMS = 10
traceDecay = 0.985
sigma = 0.2
# genrate
otherPara = getOtherPara(cond, stepDuration)
MSPara = getMSPara(cond, stepDuration, nMS, traceDecay, sigma)
############# simulate for the distribution of toalEarnings ##########
nPara = 5
paraNames = c('phi', 'tau', 'gamma', 'lambda', 'wIni')
nValue = 3
nComb = nValue ^ nPara
initialSpace = matrix(NA, nValue^nPara, nPara)
initialSpace[,1] = rep(c(0.01, 0.05, 0.2), each = nValue^(nPara - 1)) # phi
initialSpace[,2] = rep(rep(seq(8, 24, 8), each = nValue), nValue^(nPara - 2)) # tau
initialSpace[,3] = rep(rep(seq(0.90, 0.98, 0.04), each = nValue^2), nValue^(nPara - 3))
initialSpace[,4] = rep(rep(seq(0.90, 0.98, 0.04), each = nValue^3), nValue^(nPara - 4))
initialSpace[,5] = rep(rep(seq(2, 8, 3), each = nValue^4), nValue^(nPara - 5))
outFile = 'QStarData'
save('initialSpace', 'nValue', 'nPara', 'paraNames', 'nComb',
file = sprintf('%s/initialSpace.RData', outFile))
# set seed
set.seed(123)
# simualte
nRep = 5
tMax = otherPara[['tMax']]
TrialEarnings = array(dim = c(nValue^nPara, nRep, blockSecs / iti + 1))
RewardDelays = array(dim = c(nValue^nPara, nRep, blockSecs / iti + 1))
Ws = array(dim = c(nValue^nPara, nRep, tMax / stepDuration)) # diifferent from master
TimeWaited = array(dim = c(nValue^nPara, nRep, blockSecs / iti + 1))
vaQuits = array(dim = c(nValue^nPara, nRep, tMax / stepDuration, blockSecs / iti + 1))
vaWaits = array(dim = c(nValue^nPara, nRep, tMax / stepDuration, blockSecs / iti + 1))
for(i in 1 : 1:nrow(initialSpace)){
para = initialSpace[i,]
for(j in 1 : nRep ){
tempt=  QStarModel(para,MSPara, otherPara, cond)
TrialEarnings[i, j,] = tempt[['trialEarnings']]
Ws[i, j,] = tempt[['ws']]
RewardDelays[i, j,] = tempt[['rewardDelays']]
TimeWaited[i, j, ] = tempt[['timeWaited']]
vaQuits[i, j,  , ] = tempt[['vaQuits']]
vaWaits[i, j, ,  ] = tempt[['vaWaits']]
}
}
# organize and save outputs
outputData = list("ws" = Ws, "timeWaited" = TimeWaited,
"rewardDelays" = RewardDelays, "trialEarnings" = TrialEarnings,
"vaWaits" = vaWaits, "vaQuits" = vaQuits
)
outFile = 'QStarData'
if(cond == "unif16") rawHPData = outputData else rawLPData = outputData
fileName = sprintf('outputs/%s/rawHPData.RData', outFile)
save(rawHPData,file = fileName)
fileName = sprintf('outputs/%s/rawLPData.RData', outFile)
save(rawLPData,file = fileName)
rm(list = ls())
###### load data and functions #######
source('subFxs/helperFxs.R')
library('ggplot2')
source('subFxs/plotThemes.R')
source('subFxs/wtwSettings.R')
source("actionValueViewer.R")
load('outputs/QStarData/colpData.RData')
load('outputs/QStarData/RawHPData.RData')
load('outputs/QStarData/RawLPData.RData')
###### choose condition ########3
condIdx = 2
cond = conditions[condIdx]
condName = conditionNames[condIdx]
inputColp = if(condName == 'HP') inputColp = colpHPData else inputColp = colpLPData
inputRaw = if(condName == 'HP') inputRaw = rawHPData else inputRaw= rawLPData
tMax = tMaxs[condIdx]
trialTick = trialTicks[[condIdx]] # so here if use [2] then get a list
nCombList = which(inputColp$AUC <= 6 & inputColp$AUC >= 2 )
# choose figrues you want to plot
plotTrialData = F
plotKMSC= T
drawTimeSample = T
plotActionValue = T
i = nCombList[nCb]
j = 1
# prepare total earnings, wtw and AUC
totalEarnings = inputColp$totalEarnings[i]
wtw = inputColp$wtw[i]
AUC = inputColp$AUC[i]
label = sprintf('colp stat, earn: %d, wtw: %.2f, AUC: %.2f',
totalEarnings, wtw, AUC)
# block data
blockData = data.frame(trialEarnings = inputRaw$trialEarnings[i,j,],
scheduledWait = inputRaw$rewardDelays[i,j,],
timeWaited = inputRaw$timeWaited[i,j,],
trialNum = 1 : length(inputRaw$timeWaited[i,j,])
)
waitDuration = blockData$timeWaited
waitDuration[is.na(waitDuration)] = blockData$scheduledWait[is.na(waitDuration)]
blockData$waitDuration = waitDuration
endTick = match(0, inputRaw$rewardDelays[i,j,]) - 1
blockData = blockData[1:endTick, ]
if(plotTrialData){
# plot
trialPlots(blockData, label)
}
if(plotTrialData) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# look at kmsc
if(plotKMSC){
# change name
rewardDelay = blockData$scheduledWait
quitIdx = (blockData$trialEarnings == 0)
kmscResults = kmscSimple(blockData$waitDuration, quitIdx, tMax, trialTick)
plotData = data.frame(pSurvival = kmscResults$kmOnGrid, time = trialTicks[[condName]])
p = ggplot(plotData, aes(time, pSurvival)) + geom_line() + ylim(c(0, 1)) + displayTheme +
ggtitle(label)
print(p)
}
if(plotKMSC) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# draw wait duration distribution
if(drawTimeSample){
# prepare pdf
cdf = 1 - kmscResults$kmOnGrid;
cdf[length(cdf)] = 1
pdf = diff(c(0, cdf)) # hre 0 is the time tick before 0
draws = sample(trialTicks[[condName]], size = 1000, replace = TRUE, prob = pdf)
p = ggplot(data.frame(draws),aes(draws)) + geom_histogram(bins = 50) + xlim(c(0 - 1, tMax+3)) +
displayTheme + xlab('Wait duration / s') + ggtitle(label)
print(p)
}
if(drawTimeSample) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# plot action value
# prepare data
if(plotActionValue){
vaWaits = inputRaw$vaWaits[i,j, , ]
vaQuits = inputRaw$vaQuits[i,j, , ]
actionValueViewer(vaWaits, vaQuits, blockData)
}
if(plotActionValue) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
nCb = 1
i = nCombList[nCb]
j = 1
# prepare total earnings, wtw and AUC
totalEarnings = inputColp$totalEarnings[i]
wtw = inputColp$wtw[i]
AUC = inputColp$AUC[i]
label = sprintf('colp stat, earn: %d, wtw: %.2f, AUC: %.2f',
totalEarnings, wtw, AUC)
# block data
blockData = data.frame(trialEarnings = inputRaw$trialEarnings[i,j,],
scheduledWait = inputRaw$rewardDelays[i,j,],
timeWaited = inputRaw$timeWaited[i,j,],
trialNum = 1 : length(inputRaw$timeWaited[i,j,])
)
waitDuration = blockData$timeWaited
waitDuration[is.na(waitDuration)] = blockData$scheduledWait[is.na(waitDuration)]
blockData$waitDuration = waitDuration
endTick = match(0, inputRaw$rewardDelays[i,j,]) - 1
blockData = blockData[1:endTick, ]
if(plotTrialData){
# plot
trialPlots(blockData, label)
}
if(plotTrialData) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# look at kmsc
if(plotKMSC){
# change name
rewardDelay = blockData$scheduledWait
quitIdx = (blockData$trialEarnings == 0)
kmscResults = kmscSimple(blockData$waitDuration, quitIdx, tMax, trialTick)
plotData = data.frame(pSurvival = kmscResults$kmOnGrid, time = trialTicks[[condName]])
p = ggplot(plotData, aes(time, pSurvival)) + geom_line() + ylim(c(0, 1)) + displayTheme +
ggtitle(label)
print(p)
}
if(plotKMSC) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# draw wait duration distribution
if(drawTimeSample){
# prepare pdf
cdf = 1 - kmscResults$kmOnGrid;
cdf[length(cdf)] = 1
pdf = diff(c(0, cdf)) # hre 0 is the time tick before 0
draws = sample(trialTicks[[condName]], size = 1000, replace = TRUE, prob = pdf)
p = ggplot(data.frame(draws),aes(draws)) + geom_histogram(bins = 50) + xlim(c(0 - 1, tMax+3)) +
displayTheme + xlab('Wait duration / s') + ggtitle(label)
print(p)
}
if(drawTimeSample) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# plot action value
# prepare data
if(plotActionValue){
vaWaits = inputRaw$vaWaits[i,j, , ]
vaQuits = inputRaw$vaQuits[i,j, , ]
actionValueViewer(vaWaits, vaQuits, blockData)
}
i = nCombList[nCb]
j = 1
# prepare total earnings, wtw and AUC
totalEarnings = inputColp$totalEarnings[i]
wtw = inputColp$wtw[i]
AUC = inputColp$AUC[i]
label = sprintf('colp stat, earn: %d, wtw: %.2f, AUC: %.2f',
totalEarnings, wtw, AUC)
# block data
blockData = data.frame(trialEarnings = inputRaw$trialEarnings[i,j,],
scheduledWait = inputRaw$rewardDelays[i,j,],
timeWaited = inputRaw$timeWaited[i,j,],
trialNum = 1 : length(inputRaw$timeWaited[i,j,])
)
waitDuration = blockData$timeWaited
waitDuration[is.na(waitDuration)] = blockData$scheduledWait[is.na(waitDuration)]
blockData$waitDuration = waitDuration
endTick = match(0, inputRaw$rewardDelays[i,j,]) - 1
blockData = blockData[1:endTick, ]
if(plotTrialData){
# plot
trialPlots(blockData, label)
}
if(plotTrialData) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# look at kmsc
if(plotKMSC){
# change name
rewardDelay = blockData$scheduledWait
quitIdx = (blockData$trialEarnings == 0)
kmscResults = kmscSimple(blockData$waitDuration, quitIdx, tMax, trialTick)
plotData = data.frame(pSurvival = kmscResults$kmOnGrid, time = trialTicks[[condName]])
p = ggplot(plotData, aes(time, pSurvival)) + geom_line() + ylim(c(0, 1)) + displayTheme +
ggtitle(label)
print(p)
}
if(plotKMSC) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# draw wait duration distribution
if(drawTimeSample){
# prepare pdf
cdf = 1 - kmscResults$kmOnGrid;
cdf[length(cdf)] = 1
pdf = diff(c(0, cdf)) # hre 0 is the time tick before 0
draws = sample(trialTicks[[condName]], size = 1000, replace = TRUE, prob = pdf)
p = ggplot(data.frame(draws),aes(draws)) + geom_histogram(bins = 50) + xlim(c(0 - 1, tMax+3)) +
displayTheme + xlab('Wait duration / s') + ggtitle(label)
print(p)
}
if(drawTimeSample) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# plot action value
# prepare data
if(plotActionValue){
vaWaits = inputRaw$vaWaits[i,j, , ]
vaQuits = inputRaw$vaQuits[i,j, , ]
actionValueViewer(vaWaits, vaQuits, blockData)
}
i = nCombList[nCb]
j = 1
# prepare total earnings, wtw and AUC
totalEarnings = inputColp$totalEarnings[i]
wtw = inputColp$wtw[i]
AUC = inputColp$AUC[i]
label = sprintf('colp stat, earn: %d, wtw: %.2f, AUC: %.2f',
totalEarnings, wtw, AUC)
# block data
blockData = data.frame(trialEarnings = inputRaw$trialEarnings[i,j,],
scheduledWait = inputRaw$rewardDelays[i,j,],
timeWaited = inputRaw$timeWaited[i,j,],
trialNum = 1 : length(inputRaw$timeWaited[i,j,])
)
waitDuration = blockData$timeWaited
waitDuration[is.na(waitDuration)] = blockData$scheduledWait[is.na(waitDuration)]
blockData$waitDuration = waitDuration
endTick = match(0, inputRaw$rewardDelays[i,j,]) - 1
blockData = blockData[1:endTick, ]
if(plotTrialData){
# plot
trialPlots(blockData, label)
}
if(plotTrialData) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# look at kmsc
if(plotKMSC){
# change name
rewardDelay = blockData$scheduledWait
quitIdx = (blockData$trialEarnings == 0)
kmscResults = kmscSimple(blockData$waitDuration, quitIdx, tMax, trialTick)
plotData = data.frame(pSurvival = kmscResults$kmOnGrid, time = trialTicks[[condName]])
p = ggplot(plotData, aes(time, pSurvival)) + geom_line() + ylim(c(0, 1)) + displayTheme +
ggtitle(label)
print(p)
}
if(plotKMSC) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
if(drawTimeSample){
# prepare pdf
cdf = 1 - kmscResults$kmOnGrid;
cdf[length(cdf)] = 1
pdf = diff(c(0, cdf)) # hre 0 is the time tick before 0
draws = sample(trialTicks[[condName]], size = 1000, replace = TRUE, prob = pdf)
p = ggplot(data.frame(draws),aes(draws)) + geom_histogram(bins = 50) + xlim(c(0 - 1, tMax+3)) +
displayTheme + xlab('Wait duration / s') + ggtitle(label)
print(p)
}
if(drawTimeSample) {
readline(prompt = paste(nCb, '(hit ENTER to continue)'))
}
# prepare data
if(plotActionValue){
vaWaits = inputRaw$vaWaits[i,j, , ]
vaQuits = inputRaw$vaQuits[i,j, , ]
actionValueViewer(vaWaits, vaQuits, blockData)
}
wIni = vaWaits[1,1]
wIni
blockData$timeWaited
phi = para[1]
tau = para[2]
gamma = para[3]
lambda = para[4]
wIni = para[5]
# task para
source('subFxs/taskFxs.R')
source("subFxs/wtwSettings.R")
# read otherPara
tMax= otherPara[['tMax']]
stepDuration = otherPara[['stepDuration']]
timeTicks = otherPara[['timeTicks']] # begin timepoint of states
nTimeStep = tMax / stepDuration
# actionList
actionList = c('wait', 'quit') # wait means wait until t+1, quit means quit at t
########### simulation repeatedly ############
# initialize action value, eligibility trace and stat
ws = rep(wIni, nTimeStep) # weight vector for "wait", each element for each timeStep
es = rep(0, nTimeStep); # es vector for "wait"
onsetXs = 1 # onset state is 1
xs = onsetXs # every trial starts from the onset state
# additionally initialize vaWaits and vaQuits
vaWaits = matrix(NA, tMax / stepDuration, blockSecs / iti + 1);
vaQuits = matrix(NA, tMax / stepDuration, blockSecs / iti + 1);
endTimes = rep(NA, length = (blockSecs / iti + 1))
# initialize time and reward seq
totalSecs = 0
seq = c()
rewardDelays = rep(0, blockSecs / iti + 1)
tIdx = 0
stepGap = 1 # since es = 0 initially, so this value is abitratry
# initialize outputs
trialEarnings = rep(0, blockSecs / iti + 1)
timeWaited = rep(0, blockSecs / iti + 1)
tIdx = tIdx + 1
# sample rewardDelay
rewardOutputs = drawSample(cond, seq)
rewardDelay = rewardOutputs[['delay']]
seq = rewardOutputs[['seq']]
# calculaye available time steps
# since we use floor there maybe 0.5 sec error (less than 90 s)
nAvaStep = min(floor((blockSecs - totalSecs) / stepDuration), nTimeStep)
phi = para[1]
tau = para[2]
gamma = para[3]
lambda = para[4]
wIni = para[5]
# task para
source('subFxs/taskFxs.R')
source("subFxs/wtwSettings.R")
